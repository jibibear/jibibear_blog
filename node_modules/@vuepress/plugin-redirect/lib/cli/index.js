#!/usr/bin/env node
import{removeEndingSlash as v,removeLeadingSlash as g}from"@vuepress/helper";import{createCommand as b}from"commander";import{resolveCliAppConfig as y,resolveUserConfigPath as C,resolveUserConfigConventionalPath as w,loadUserConfig as j,resolveAppConfig as x,transformUserConfigToPlugin as $}from"vuepress/cli";import{createBuildApp as P}from"vuepress/core";import{fs as o,logger as n,path as s}from"vuepress/utils";var k="@vuepress/plugin-redirect",S="2.0.0-rc.71",A="VuePress plugin - redirect",D=["vuepress-plugin","vuepress","plugin","redirect"],E="https://ecosystem.vuejs.press/plugins/tools/redirect.html",T={url:"https://github.com/vuepress/ecosystem/issues"},U={type:"git",url:"git+https://github.com/vuepress/ecosystem.git",directory:"plugins/tools/plugin-redirect"},V="MIT",H={name:"Mr.Hope",email:"mister-hope@outlook.com",url:"https://mister-hope.com"},G="module",M={".":"./lib/node/index.js","./client":"./lib/client/index.js","./package.json":"./package.json"},R="./lib/node/index.js",F="./lib/node/index.d.ts",I={"vp-redirect":"./lib/cli/index.js"},L=["lib"],N={build:"tsc -b tsconfig.build.json",bundle:"rollup -c rollup.config.ts --configPlugin esbuild",clean:"rimraf --glob ./lib ./*.tsbuildinfo",style:"sass src:lib --embed-sources --style=compressed --pkg-importer=node"},O={"@vuepress/helper":"workspace:*","@vueuse/core":"^12.4.0",commander:"^13.0.0",vue:"^3.5.13"},q={vuepress:"2.0.0-rc.19"},z={access:"public"},B={name:k,version:S,description:A,keywords:D,homepage:E,bugs:T,repository:U,license:V,author:H,type:G,exports:M,main:R,types:F,bin:I,files:L,scripts:N,dependencies:O,peerDependencies:q,publishConfig:z};const _=e=>`<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="robots" content="noindex">
  <meta http-equiv="refresh" content="0; url=${e}">
  <link rel="canonical" href="${e}">
  <title>Redirecting...</title>
  <script>
    const anchor = window.location.hash.substring(1);
    location.href = \`${e}\${anchor? \`#\${anchor}\`: ""}\`;
  <\/script>
</head>
<body>
  <p>Redirecting...</p>
</body>
</html>
`,t=b("vp-redirect");t.summary("Generate redirect site").description("Generate redirect site for current VuePress project").option("--hostname <hostname>","Hostname to redirect to (E.g.: https://new.example.com/)","/").option("-c, --config [config]","Set path to config file").option("--cache [cache]","Set the directory of the cache files").option("--temp [temp]","Set the directory of the temporary files").option("--clean-cache","Clean the cache files before generation").option("--clean-temp","Clean the temporary files before generation").argument("<source>","Source directory of VuePress project").argument("[output]","Output folder (default: .vuepress/redirect relative to source folder)").action(async(e,a,i)=>{process.env.NODE_ENV??="production",o.existsSync(e)||t.error(`Source directory ${e} does not exist!`);const c=y(e,{}),h=i.config?C(i.config):w(c.source),{userConfig:p}=await j(h),l=x({defaultAppConfig:{},cliAppConfig:c,userConfig:p});if(l===null)return;const r=P(l);r.use($(p,c.source)),i.cleanTemp===!0&&(n.info("Cleaning temp..."),await o.remove(r.dir.temp())),i.cleanCache===!0&&(n.info("Cleaning cache..."),await o.remove(r.dir.cache()));const u=a?s.join(process.cwd(),a):s.join(r.dir.source(),".vuepress","redirect");await o.emptyDir(u),n.info("Initializing VuePress and preparing data..."),await r.init(),n.info("Generating redirect pages..."),await Promise.all(r.pages.map(d=>{const f=`${v(i.hostname)}${r.siteData.base}${g(d.path)}`,m=s.join(u,g(d.path.replace(/\/$/,"/index.html")));return o.ensureDir(s.dirname(m)).then(()=>o.writeFile(m,_(f)))}))}),t.version(B.version),t.showHelpAfterError("add --help for additional information"),await t.parseAsync();
//# sourceMappingURL=index.js.map
