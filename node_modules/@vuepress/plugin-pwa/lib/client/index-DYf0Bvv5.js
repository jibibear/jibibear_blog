import d from"mitt";import{provide as l,onMounted as i}from"vue";import{p as m}from"./usePwaEvent-CUDY9qle.js";import{withBase as u}from"vuepress/client";const n=()=>{navigator.serviceWorker.getRegistration().then(r=>{r?.active&&r.addEventListener("updatefound",()=>{window.location.reload(!0)})})},c=async(r,t={},e=!0)=>{const{register:a}=await import("register-service-worker");a(r,{ready(o){e&&console.info("[Service Worker]: active"),t.ready?.(o)},registered(o){e&&console.log("[Service Worker]: registered"),t.registered?.(o)},cached(o){e&&console.log("[Service Worker]: cached"),t.cached?.(o)},async updatefound(o){await navigator.serviceWorker.getRegistration()&&(e&&console.log("[Service Worker]: update found"),t.updatefound?.(o))},updated(o){e&&console.log("[Service Worker]: updated"),t.updated?.(o)},offline(){e&&console.log("[Service Worker]: offline"),t.offline?.()},error(o){e&&console.error("[Service Worker]: ",o),t.error?.(o)}})},s=async(r,t)=>c(u(r),{ready(e){t.emit("ready",e)},registered(e){t.emit("registered",e)},cached(e){t.emit("cached",e)},updatefound(e){t.emit("updatefound",e)},updated(e){const a="service-worker-version",o=Number(localStorage.getItem(a)||0);localStorage.setItem(a,(o+1).toString()),localStorage.removeItem("manifest"),t.emit("updated",e)},offline(){t.emit("offline")},error(e){t.emit("error",e)}}),v=(r,t=!1)=>{if(__VUEPRESS_SSR__)return;const e=d();l(m,e),i(async()=>{if(__VUEPRESS_DEV__||!("serviceWorker"in navigator))return;let a=!1;navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("controllerchange",()=>{a||(a=!0,window.location.reload())}),t&&n(),await s(r,e)})},f=()=>{i(()=>{if(window.matchMedia("(display-mode: standalone)").matches){const r=document.head.querySelector('meta[name="viewport"]');if(r){r.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover");return}const t=document.createElement("meta");t.name="viewport",t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover",document.head.appendChild(t)}})};export{f as a,n as f,c as r,v as s,s as u};
//# sourceMappingURL=index-DYf0Bvv5.js.map
